---

name: Cause airflow production to refresh DAGs

on: push

#on:
  #pull_request:
    #branches:
      #- production
    #types:
      #- closed

jobs:
  deployment:
    # if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    steps:
      - name: Load secret
        id: op-load-secret
        uses: 1password/load-secrets-action@v1
        env:
          OP_CONNECT_HOST: ${{ secrets.OP_CONNECT }}
          OP_CONNECT_TOKEN: ${{ secrets.OP_API_TOKEN }}
          WEBHOOK_KEY: "op://${{ secrets.OP_VAULT_ID  }}/Airflow\ Webhook/password"
          WEBHOOK_ADDRESS: "op://${{ secrets.OP_VAULT_ID }}/Airflow\ Webhook/smee/address)"

      - name: Invoke deployment hook
        uses: distributhor/workflow-webhook@v2
        env:
          webhook_url: ${{ env.WEBHOOK_ADDRESS }}
          webhook_secret: ${{ env.WEBHOOK_KEY }}
          curl_opts: '-H "X-Webhook-Key: ${{ env.WEBHOOK_KEY }}"'
          # data: '{ "webhook_key": "${{ env.WEBHOOK_KEY }}" }'
